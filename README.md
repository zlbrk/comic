# comic
comi compiler utility

Объединяет все файлы, находящиеся в директории проекта в один большой файл, предназначенный для автоматической генерации расчетных баз данных.

Текущая версия является полностью функциональной в рамках ряда допущений на стиль оформления исходных comi-макросов. Например, считается, что макрос точки входа (e_main.comi или m_main.comi) вызывает дочерние макросы с помощью сокращенной команды $COMI, которой передается имя дочернего макроса в одинарных кавычках и без расширения. Если дочерний макрос будет вызван полной командой $COMINPUT -- компилятор не сможет правильно обработать такой вызов. Аналогичная ситуация возникнет, если имя макроса не будет заключено в одинарные кавычки (это допускается интерпретатором Opera3D) или будет содержать расширение. 

## Пример
вызова макроса e_geom.comi, который обрабатывается правильно:

```
$COMI 'e_geom'
```
## Примеры 
вызовов макроса e_geom.comi, которые не могут быть обработаны текущей версией правильно:

```
$COMI e_geom
$COMI 'e_geom.comi'
$COMI f:/project/e_geom.comi
$COMINPUT e_geom
$COMINPUT 'e_geom'
$COMINPUT 'e_geom.comi'
$COMINPUT 'f:/project/e_geom.comi'
```
и т.д.
Я предлагаю первую итерацию доработки разделить на пять маленьких задач, которые можно будет относительно легко решить:

# TODO

1. Opera не различает регистр, а go различает, но мой код почему-то работает (магия strings.EqualFold()?), надо бы разобраться почему и, возможно, сделать явное приведение прочитанной строки к верхнему регистру (в интерфейсе оперы переменные печатаются всеми большими буквами, как в фортране).

2. Надо добавить проверку на наличие одинарных кавычек вокруг имени дочернего скрипта. Т.е. чтобы, например, `$COMI 'e_geom'` и `$COMI e_geom` могли быть обработаны корректно.

3. Надо добавить проверку на наличие расширения .comi в имени дочернего скрипта, чтобы `$COMI 'e_geom.comi'` и `$COMI e_geom.comi` могли быть обработаны корректно.

4. Уже сложнее. Надо сделать так, чтобы компилятор понимал относительные и абсолютные пути unix-style к файлам. Проблема в том, что если вы попробуете сделать так `comic ./e_main.comi`, то имя скомпилированного файла не будет начинаться с символа `e`, потому что он воспримет первым символом точку относительного пути.

5. И последнее, что надо сделать -- это научить компилятор понимать абсолютные пути к дочерним файлам, чтобы работали конструкции вроде `$COMI 'F:\Opera3D\TestProject\model_e\geom.comi'`. Сейчас такое не прокатит.
